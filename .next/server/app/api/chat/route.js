"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/chat/route";
exports.ids = ["app/api/chat/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=C%3A%5CUsers%5Cplenty_seafood%5CDesktop%5CLLM_chatbox%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cplenty_seafood%5CDesktop%5CLLM_chatbox&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=C%3A%5CUsers%5Cplenty_seafood%5CDesktop%5CLLM_chatbox%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cplenty_seafood%5CDesktop%5CLLM_chatbox&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_plenty_seafood_Desktop_LLM_chatbox_src_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/chat/route.ts */ \"(rsc)/./src/app/api/chat/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/chat/route\",\n        pathname: \"/api/chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/chat/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\plenty_seafood\\\\Desktop\\\\LLM_chatbox\\\\src\\\\app\\\\api\\\\chat\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_plenty_seafood_Desktop_LLM_chatbox_src_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/chat/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjaGF0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZjaGF0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGY2hhdCUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNwbGVudHlfc2VhZm9vZCU1Q0Rlc2t0b3AlNUNMTE1fY2hhdGJveCU1Q3NyYyU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDcGxlbnR5X3NlYWZvb2QlNUNEZXNrdG9wJTVDTExNX2NoYXRib3gmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzhCO0FBQzNHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGxtLWNoYXRib3gvPzI1ODkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxccGxlbnR5X3NlYWZvb2RcXFxcRGVza3RvcFxcXFxMTE1fY2hhdGJveFxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxjaGF0XFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jaGF0L3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvY2hhdFwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvY2hhdC9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXHBsZW50eV9zZWFmb29kXFxcXERlc2t0b3BcXFxcTExNX2NoYXRib3hcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcY2hhdFxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvY2hhdC9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=C%3A%5CUsers%5Cplenty_seafood%5CDesktop%5CLLM_chatbox%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cplenty_seafood%5CDesktop%5CLLM_chatbox&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/chat/route.ts":
/*!***********************************!*\
  !*** ./src/app/api/chat/route.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n\nconst dynamic = \"force-dynamic\"; // 确保每次请求都重新生成响应\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        console.log(\"收到的原始请求体:\", JSON.stringify(body));\n        // 获取环境变量\n        const COZE_API_BASE_URL = \"https://api.coze.cn/v3\" || 0;\n        const COZE_BOT_ID = body.bot_id || \"7477479625686499378\" || 0;\n        const COZE_API_KEY = \"您的API密钥\" || 0;\n        const COZE_SHORTCUT_COMMAND_ID = \"请在此填入您的快捷指令ID\" || 0;\n        console.log(\"API路由处理请求，Bot ID:\", COZE_BOT_ID);\n        if (COZE_SHORTCUT_COMMAND_ID) {\n            console.log(\"使用快捷指令ID:\", COZE_SHORTCUT_COMMAND_ID);\n        } else {\n            console.warn(\"未提供快捷指令ID，这可能导致API请求失败\");\n        }\n        // 检查是否需要流式响应\n        const isStream = body.stream !== false;\n        // 提取消息内容\n        const messages = [];\n        if (body.additional_messages && Array.isArray(body.additional_messages)) {\n            messages.push(...body.additional_messages);\n        } else if (body.messages && Array.isArray(body.messages)) {\n            messages.push(...body.messages);\n        }\n        // 确保至少有一条消息\n        if (messages.length === 0 && body.content) {\n            messages.push({\n                role: \"user\",\n                content: body.content\n            });\n        }\n        // 构建请求体 - 根据Coze API v3的格式\n        const requestBody = {\n            bot_id: COZE_BOT_ID,\n            user_id: body.user_id || \"default_user\",\n            auto_save_history: true,\n            stream: isStream,\n            messages: messages,\n            // 添加快捷指令ID（如果有）\n            ...COZE_SHORTCUT_COMMAND_ID && {\n                shortcut_command_id: COZE_SHORTCUT_COMMAND_ID\n            }\n        };\n        const apiEndpoint = `${COZE_API_BASE_URL}/chat`;\n        console.log(\"发送请求到Coze API:\", apiEndpoint);\n        console.log(\"请求体:\", JSON.stringify(requestBody));\n        // 调用Coze API\n        const response = await fetch(apiEndpoint, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: `Bearer ${COZE_API_KEY}`\n            },\n            body: JSON.stringify(requestBody)\n        });\n        // 如果不成功，返回错误\n        if (!response.ok) {\n            const errorText = await response.text();\n            console.error(\"Coze API错误:\", {\n                status: response.status,\n                text: errorText\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: `API调用失败: ${response.status}, ${errorText}`\n            }, {\n                status: response.status\n            });\n        }\n        console.log(\"Coze API响应状态码:\", response.status);\n        console.log(\"Coze API响应头部:\", Object.fromEntries(response.headers.entries()));\n        // 如果不是流式响应，直接返回JSON\n        if (!isStream) {\n            const data = await response.json();\n            console.log(\"非流式响应数据:\", JSON.stringify(data).substring(0, 200) + \"...\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(data);\n        }\n        // 添加一个调试用的读取器，用于记录响应内容而不消耗它\n        const responseClone = response.clone();\n        // 异步读取并记录响应内容\n        (async ()=>{\n            try {\n                if (responseClone.body) {\n                    const reader = responseClone.body.getReader();\n                    const decoder = new TextDecoder();\n                    let debugOutput = \"\";\n                    let chunkCount = 0;\n                    while(true){\n                        const { done, value } = await reader.read();\n                        if (done) break;\n                        const chunk = decoder.decode(value, {\n                            stream: true\n                        });\n                        debugOutput += chunk;\n                        chunkCount++;\n                        // 每接收5个数据块打印一次，避免日志过多\n                        if (chunkCount % 5 === 0) {\n                            console.log(`收到的原始响应数据(${chunkCount}个块)前200字符:`, debugOutput.substring(0, 200) + \"...\");\n                        }\n                    }\n                    console.log(\"完整的响应数据前500字符:\", debugOutput.substring(0, 500) + \"...\");\n                    console.log(\"响应数据总长度:\", debugOutput.length);\n                }\n            } catch (error) {\n                console.error(\"读取响应数据出错:\", error);\n            }\n        })();\n        // 发送模拟数据测试\n        if (response.body === null) {\n            // 如果响应体为空，发送测试数据\n            console.log(\"响应体为空，发送测试数据\");\n            // 创建一个可读流\n            const encoder = new TextEncoder();\n            const testData = [\n                'data: {\"content\":\"你好！\",\"done\":false}\\n\\n',\n                'data: {\"content\":\"我是Coze智能助手。\",\"done\":false}\\n\\n',\n                'data: {\"content\":\"有什么我可以帮助你的吗？\",\"done\":false}\\n\\n',\n                'data: {\"content\":\"\",\"done\":true}\\n\\n',\n                \"data: [DONE]\\n\\n\"\n            ];\n            const { readable, writable } = new TransformStream();\n            const writer = writable.getWriter();\n            // 模拟发送数据\n            (async ()=>{\n                for (const message of testData){\n                    await new Promise((resolve)=>setTimeout(resolve, 500));\n                    await writer.write(encoder.encode(message));\n                    console.log(\"发送测试数据:\", message.trim());\n                }\n                await writer.close();\n            })();\n            return new Response(readable, {\n                headers: {\n                    \"Content-Type\": \"text/event-stream\",\n                    \"Cache-Control\": \"no-cache\",\n                    Connection: \"keep-alive\"\n                }\n            });\n        }\n        // 对于流式响应，创建自定义转换流\n        const { readable, writable } = new TransformStream({\n            async transform (chunk, controller) {\n                // 转发原始数据块\n                controller.enqueue(chunk);\n                // 显示接收的数据（用于调试）\n                const decoder = new TextDecoder();\n                const text = decoder.decode(chunk, {\n                    stream: true\n                });\n                console.log(\"转发数据块:\", text.trim().substring(0, 100) + (text.length > 100 ? \"...\" : \"\"));\n            },\n            flush (controller) {\n                // 当原始流结束时，发送[DONE]标记\n                const encoder = new TextEncoder();\n                controller.enqueue(encoder.encode('data: {\"content\":\"\",\"done\":true}\\n\\n'));\n                controller.enqueue(encoder.encode(\"data: [DONE]\\n\\n\"));\n                console.log(\"发送[DONE]标记，通知客户端流结束\");\n            }\n        });\n        // 开始转发流\n        response.body.pipeTo(writable).catch((error)=>{\n            console.error(\"流转发错误:\", error);\n        });\n        // 返回流式响应\n        return new Response(readable, {\n            headers: {\n                \"Content-Type\": \"text/event-stream\",\n                \"Cache-Control\": \"no-cache\",\n                Connection: \"keep-alive\"\n            }\n        });\n    } catch (error) {\n        console.error(\"API路由错误:\", error instanceof Error ? error.message : String(error));\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"服务器内部错误\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BQU0sUUFBUSxFQUFDO1lBRWxFO1lBQ0F3RCxPQUFNRixVQUFVO2dCQUNkLHFCQUFxQjtnQkFDckIsTUFBTW5CLFVBQVUsSUFBSUM7Z0JBQ3BCa0IsV0FBV0MsT0FBTyxDQUNoQnBCLFFBQVFhLE1BQU0sQ0FBQztnQkFFakJNLFdBQVdDLE9BQU8sQ0FBQ3BCLFFBQVFhLE1BQU0sQ0FBQztnQkFDbEN4RSxRQUFRQyxHQUFHLENBQUM7WUFDZDtRQUNGO1FBRUEsUUFBUTtRQUNSOEIsU0FBU2pDLElBQUksQ0FBQ21GLE1BQU0sQ0FBQ2xCLFVBQVVtQixLQUFLLENBQUMsQ0FBQzNDO1lBQ3BDdkMsUUFBUXVDLEtBQUssQ0FBQyxVQUFVQTtRQUMxQjtRQUVBLFNBQVM7UUFDVCxPQUFPLElBQUlvQyxTQUFTYixVQUFVO1lBQzVCNUIsU0FBUztnQkFDUCxnQkFBZ0I7Z0JBQ2hCLGlCQUFpQjtnQkFDakIwQyxZQUFZO1lBQ2Q7UUFDRjtJQUNGLEVBQUUsT0FBT3JDLE9BQU87UUFDZHZDLFFBQVF1QyxLQUFLLENBQ1gsWUFDQUEsaUJBQWlCNEMsUUFBUTVDLE1BQU00QixPQUFPLEdBQUdpQixPQUFPN0M7UUFFbEQsT0FBTzdDLHFEQUFZQSxDQUFDSyxJQUFJLENBQUM7WUFBRXdDLE9BQU87UUFBVSxHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUMvRDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGxtLWNoYXRib3gvLi9zcmMvYXBwL2FwaS9jaGF0L3JvdXRlLnRzPzQ2YjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCB7IFBhc3NUaHJvdWdoIH0gZnJvbSBcInN0cmVhbVwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IGR5bmFtaWMgPSBcImZvcmNlLWR5bmFtaWNcIjsgLy8g56Gu5L+d5q+P5qyh6K+35rGC6YO96YeN5paw55Sf5oiQ5ZON5bqUXHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcclxuICAgIGNvbnNvbGUubG9nKFwi5pS25Yiw55qE5Y6f5aeL6K+35rGC5L2TOlwiLCBKU09OLnN0cmluZ2lmeShib2R5KSk7XHJcblxyXG4gICAgLy8g6I635Y+W546v5aKD5Y+Y6YePXHJcbiAgICBjb25zdCBDT1pFX0FQSV9CQVNFX1VSTCA9XHJcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0NPWkVfQVBJX0JBU0VfVVJMIHx8IFwiaHR0cHM6Ly9hcGkuY296ZS5jbi92M1wiO1xyXG4gICAgY29uc3QgQ09aRV9CT1RfSUQgPVxyXG4gICAgICBib2R5LmJvdF9pZCB8fFxyXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19DT1pFX0JPVF9JRCB8fFxyXG4gICAgICBcIjc0Nzc0Nzk2MjU2ODY0OTkzNzhcIjtcclxuICAgIGNvbnN0IENPWkVfQVBJX0tFWSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0NPWkVfQVBJX0tFWSB8fCBcIlwiO1xyXG4gICAgY29uc3QgQ09aRV9TSE9SVENVVF9DT01NQU5EX0lEID1cclxuICAgICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQ09aRV9TSE9SVENVVF9DT01NQU5EX0lEIHx8XHJcbiAgICAgIGJvZHkuc2hvcnRjdXRfY29tbWFuZF9pZDtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhcIkFQSei3r+eUseWkhOeQhuivt+axgu+8jEJvdCBJRDpcIiwgQ09aRV9CT1RfSUQpO1xyXG4gICAgaWYgKENPWkVfU0hPUlRDVVRfQ09NTUFORF9JRCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhcIuS9v+eUqOW/q+aNt+aMh+S7pElEOlwiLCBDT1pFX1NIT1JUQ1VUX0NPTU1BTkRfSUQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS53YXJuKFwi5pyq5o+Q5L6b5b+r5o235oyH5LukSUTvvIzov5nlj6/og73lr7zoh7RBUEnor7fmsYLlpLHotKVcIik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5qOA5p+l5piv5ZCm6ZyA6KaB5rWB5byP5ZON5bqUXHJcbiAgICBjb25zdCBpc1N0cmVhbSA9IGJvZHkuc3RyZWFtICE9PSBmYWxzZTtcclxuXHJcbiAgICAvLyDmj5Dlj5bmtojmga/lhoXlrrlcclxuICAgIGNvbnN0IG1lc3NhZ2VzID0gW107XHJcbiAgICBpZiAoYm9keS5hZGRpdGlvbmFsX21lc3NhZ2VzICYmIEFycmF5LmlzQXJyYXkoYm9keS5hZGRpdGlvbmFsX21lc3NhZ2VzKSkge1xyXG4gICAgICBtZXNzYWdlcy5wdXNoKC4uLmJvZHkuYWRkaXRpb25hbF9tZXNzYWdlcyk7XHJcbiAgICB9IGVsc2UgaWYgKGJvZHkubWVzc2FnZXMgJiYgQXJyYXkuaXNBcnJheShib2R5Lm1lc3NhZ2VzKSkge1xyXG4gICAgICBtZXNzYWdlcy5wdXNoKC4uLmJvZHkubWVzc2FnZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOehruS/neiHs+WwkeacieS4gOadoea2iOaBr1xyXG4gICAgaWYgKG1lc3NhZ2VzLmxlbmd0aCA9PT0gMCAmJiBib2R5LmNvbnRlbnQpIHtcclxuICAgICAgbWVzc2FnZXMucHVzaCh7XHJcbiAgICAgICAgcm9sZTogXCJ1c2VyXCIsXHJcbiAgICAgICAgY29udGVudDogYm9keS5jb250ZW50LFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDmnoTlu7ror7fmsYLkvZMgLSDmoLnmja5Db3plIEFQSSB2M+eahOagvOW8j1xyXG4gICAgY29uc3QgcmVxdWVzdEJvZHkgPSB7XHJcbiAgICAgIGJvdF9pZDogQ09aRV9CT1RfSUQsXHJcbiAgICAgIHVzZXJfaWQ6IGJvZHkudXNlcl9pZCB8fCBcImRlZmF1bHRfdXNlclwiLFxyXG4gICAgICBhdXRvX3NhdmVfaGlzdG9yeTogdHJ1ZSxcclxuICAgICAgc3RyZWFtOiBpc1N0cmVhbSxcclxuICAgICAgbWVzc2FnZXM6IG1lc3NhZ2VzLFxyXG4gICAgICAvLyDmt7vliqDlv6vmjbfmjIfku6RJRO+8iOWmguaenOacie+8iVxyXG4gICAgICAuLi4oQ09aRV9TSE9SVENVVF9DT01NQU5EX0lEICYmIHtcclxuICAgICAgICBzaG9ydGN1dF9jb21tYW5kX2lkOiBDT1pFX1NIT1JUQ1VUX0NPTU1BTkRfSUQsXHJcbiAgICAgIH0pLFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBhcGlFbmRwb2ludCA9IGAke0NPWkVfQVBJX0JBU0VfVVJMfS9jaGF0YDtcclxuICAgIGNvbnNvbGUubG9nKFwi5Y+R6YCB6K+35rGC5YiwQ296ZSBBUEk6XCIsIGFwaUVuZHBvaW50KTtcclxuICAgIGNvbnNvbGUubG9nKFwi6K+35rGC5L2TOlwiLCBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSkpO1xyXG5cclxuICAgIC8vIOiwg+eUqENvemUgQVBJXHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGFwaUVuZHBvaW50LCB7XHJcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7Q09aRV9BUElfS0VZfWAsXHJcbiAgICAgIH0sXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RCb2R5KSxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOWmguaenOS4jeaIkOWKn++8jOi/lOWbnumUmeivr1xyXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb3plIEFQSemUmeivrzpcIiwge1xyXG4gICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxyXG4gICAgICAgIHRleHQ6IGVycm9yVGV4dCxcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiBgQVBJ6LCD55So5aSx6LSlOiAke3Jlc3BvbnNlLnN0YXR1c30sICR7ZXJyb3JUZXh0fWAgfSxcclxuICAgICAgICB7IHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZyhcIkNvemUgQVBJ5ZON5bqU54q25oCB56CBOlwiLCByZXNwb25zZS5zdGF0dXMpO1xyXG4gICAgY29uc29sZS5sb2coXHJcbiAgICAgIFwiQ296ZSBBUEnlk43lupTlpLTpg6g6XCIsXHJcbiAgICAgIE9iamVjdC5mcm9tRW50cmllcyhyZXNwb25zZS5oZWFkZXJzLmVudHJpZXMoKSlcclxuICAgICk7XHJcblxyXG4gICAgLy8g5aaC5p6c5LiN5piv5rWB5byP5ZON5bqU77yM55u05o6l6L+U5ZueSlNPTlxyXG4gICAgaWYgKCFpc1N0cmVhbSkge1xyXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICBcIumdnua1geW8j+WTjeW6lOaVsOaNrjpcIixcclxuICAgICAgICBKU09OLnN0cmluZ2lmeShkYXRhKS5zdWJzdHJpbmcoMCwgMjAwKSArIFwiLi4uXCJcclxuICAgICAgKTtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOa3u+WKoOS4gOS4quiwg+ivleeUqOeahOivu+WPluWZqO+8jOeUqOS6juiusOW9leWTjeW6lOWGheWuueiAjOS4jea2iOiAl+Wug1xyXG4gICAgY29uc3QgcmVzcG9uc2VDbG9uZSA9IHJlc3BvbnNlLmNsb25lKCk7XHJcbiAgICAvLyDlvILmraXor7vlj5blubborrDlvZXlk43lupTlhoXlrrlcclxuICAgIChhc3luYyAoKSA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgaWYgKHJlc3BvbnNlQ2xvbmUuYm9keSkge1xyXG4gICAgICAgICAgY29uc3QgcmVhZGVyID0gcmVzcG9uc2VDbG9uZS5ib2R5LmdldFJlYWRlcigpO1xyXG4gICAgICAgICAgY29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpO1xyXG4gICAgICAgICAgbGV0IGRlYnVnT3V0cHV0ID0gXCJcIjtcclxuICAgICAgICAgIGxldCBjaHVua0NvdW50ID0gMDtcclxuXHJcbiAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xyXG4gICAgICAgICAgICBjb25zdCB7IGRvbmUsIHZhbHVlIH0gPSBhd2FpdCByZWFkZXIucmVhZCgpO1xyXG4gICAgICAgICAgICBpZiAoZG9uZSkgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBjaHVuayA9IGRlY29kZXIuZGVjb2RlKHZhbHVlLCB7IHN0cmVhbTogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgZGVidWdPdXRwdXQgKz0gY2h1bms7XHJcbiAgICAgICAgICAgIGNodW5rQ291bnQrKztcclxuXHJcbiAgICAgICAgICAgIC8vIOavj+aOpeaUtjXkuKrmlbDmja7lnZfmiZPljbDkuIDmrKHvvIzpgb/lhY3ml6Xlv5fov4flpJpcclxuICAgICAgICAgICAgaWYgKGNodW5rQ291bnQgJSA1ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXHJcbiAgICAgICAgICAgICAgICBg5pS25Yiw55qE5Y6f5aeL5ZON5bqU5pWw5o2uKCR7Y2h1bmtDb3VudH3kuKrlnZcp5YmNMjAw5a2X56ymOmAsXHJcbiAgICAgICAgICAgICAgICBkZWJ1Z091dHB1dC5zdWJzdHJpbmcoMCwgMjAwKSArIFwiLi4uXCJcclxuICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgY29uc29sZS5sb2coXHJcbiAgICAgICAgICAgIFwi5a6M5pW055qE5ZON5bqU5pWw5o2u5YmNNTAw5a2X56ymOlwiLFxyXG4gICAgICAgICAgICBkZWJ1Z091dHB1dC5zdWJzdHJpbmcoMCwgNTAwKSArIFwiLi4uXCJcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIuWTjeW6lOaVsOaNruaAu+mVv+W6pjpcIiwgZGVidWdPdXRwdXQubGVuZ3RoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIuivu+WPluWTjeW6lOaVsOaNruWHuumUmTpcIiwgZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICB9KSgpO1xyXG5cclxuICAgIC8vIOWPkemAgeaooeaLn+aVsOaNrua1i+ivlVxyXG4gICAgaWYgKHJlc3BvbnNlLmJvZHkgPT09IG51bGwpIHtcclxuICAgICAgLy8g5aaC5p6c5ZON5bqU5L2T5Li656m677yM5Y+R6YCB5rWL6K+V5pWw5o2uXHJcbiAgICAgIGNvbnNvbGUubG9nKFwi5ZON5bqU5L2T5Li656m677yM5Y+R6YCB5rWL6K+V5pWw5o2uXCIpO1xyXG5cclxuICAgICAgLy8g5Yib5bu65LiA5Liq5Y+v6K+75rWBXHJcbiAgICAgIGNvbnN0IGVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTtcclxuICAgICAgY29uc3QgdGVzdERhdGEgPSBbXHJcbiAgICAgICAgJ2RhdGE6IHtcImNvbnRlbnRcIjpcIuS9oOWlve+8gVwiLFwiZG9uZVwiOmZhbHNlfVxcblxcbicsXHJcbiAgICAgICAgJ2RhdGE6IHtcImNvbnRlbnRcIjpcIuaIkeaYr0NvemXmmbrog73liqnmiYvjgIJcIixcImRvbmVcIjpmYWxzZX1cXG5cXG4nLFxyXG4gICAgICAgICdkYXRhOiB7XCJjb250ZW50XCI6XCLmnInku4DkuYjmiJHlj6/ku6XluK7liqnkvaDnmoTlkJfvvJ9cIixcImRvbmVcIjpmYWxzZX1cXG5cXG4nLFxyXG4gICAgICAgICdkYXRhOiB7XCJjb250ZW50XCI6XCJcIixcImRvbmVcIjp0cnVlfVxcblxcbicsXHJcbiAgICAgICAgXCJkYXRhOiBbRE9ORV1cXG5cXG5cIixcclxuICAgICAgXTtcclxuXHJcbiAgICAgIGNvbnN0IHsgcmVhZGFibGUsIHdyaXRhYmxlIH0gPSBuZXcgVHJhbnNmb3JtU3RyZWFtKCk7XHJcbiAgICAgIGNvbnN0IHdyaXRlciA9IHdyaXRhYmxlLmdldFdyaXRlcigpO1xyXG5cclxuICAgICAgLy8g5qih5ouf5Y+R6YCB5pWw5o2uXHJcbiAgICAgIChhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIHRlc3REYXRhKSB7XHJcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MDApKTtcclxuICAgICAgICAgIGF3YWl0IHdyaXRlci53cml0ZShlbmNvZGVyLmVuY29kZShtZXNzYWdlKSk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIuWPkemAgea1i+ivleaVsOaNrjpcIiwgbWVzc2FnZS50cmltKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhd2FpdCB3cml0ZXIuY2xvc2UoKTtcclxuICAgICAgfSkoKTtcclxuXHJcbiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UocmVhZGFibGUsIHtcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcInRleHQvZXZlbnQtc3RyZWFtXCIsXHJcbiAgICAgICAgICBcIkNhY2hlLUNvbnRyb2xcIjogXCJuby1jYWNoZVwiLFxyXG4gICAgICAgICAgQ29ubmVjdGlvbjogXCJrZWVwLWFsaXZlXCIsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5a+55LqO5rWB5byP5ZON5bqU77yM5Yib5bu66Ieq5a6a5LmJ6L2s5o2i5rWBXHJcbiAgICBjb25zdCB7IHJlYWRhYmxlLCB3cml0YWJsZSB9ID0gbmV3IFRyYW5zZm9ybVN0cmVhbSh7XHJcbiAgICAgIGFzeW5jIHRyYW5zZm9ybShjaHVuaywgY29udHJvbGxlcikge1xyXG4gICAgICAgIC8vIOi9rOWPkeWOn+Wni+aVsOaNruWdl1xyXG4gICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShjaHVuayk7XHJcblxyXG4gICAgICAgIC8vIOaYvuekuuaOpeaUtueahOaVsOaNru+8iOeUqOS6juiwg+ivle+8iVxyXG4gICAgICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTtcclxuICAgICAgICBjb25zdCB0ZXh0ID0gZGVjb2Rlci5kZWNvZGUoY2h1bmssIHsgc3RyZWFtOiB0cnVlIH0pO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgICAgXCLovazlj5HmlbDmja7lnZc6XCIsXHJcbiAgICAgICAgICB0ZXh0LnRyaW0oKS5zdWJzdHJpbmcoMCwgMTAwKSArICh0ZXh0Lmxlbmd0aCA+IDEwMCA/IFwiLi4uXCIgOiBcIlwiKVxyXG4gICAgICAgICk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGZsdXNoKGNvbnRyb2xsZXIpIHtcclxuICAgICAgICAvLyDlvZPljp/lp4vmtYHnu5PmnZ/ml7bvvIzlj5HpgIFbRE9ORV3moIforrBcclxuICAgICAgICBjb25zdCBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7XHJcbiAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKFxyXG4gICAgICAgICAgZW5jb2Rlci5lbmNvZGUoJ2RhdGE6IHtcImNvbnRlbnRcIjpcIlwiLFwiZG9uZVwiOnRydWV9XFxuXFxuJylcclxuICAgICAgICApO1xyXG4gICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShlbmNvZGVyLmVuY29kZShcImRhdGE6IFtET05FXVxcblxcblwiKSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCLlj5HpgIFbRE9ORV3moIforrDvvIzpgJrnn6XlrqLmiLfnq6/mtYHnu5PmnZ9cIik7XHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDlvIDlp4vovazlj5HmtYFcclxuICAgIHJlc3BvbnNlLmJvZHkucGlwZVRvKHdyaXRhYmxlKS5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIua1gei9rOWPkemUmeivrzpcIiwgZXJyb3IpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g6L+U5Zue5rWB5byP5ZON5bqUXHJcbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKHJlYWRhYmxlLCB7XHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcInRleHQvZXZlbnQtc3RyZWFtXCIsXHJcbiAgICAgICAgXCJDYWNoZS1Db250cm9sXCI6IFwibm8tY2FjaGVcIixcclxuICAgICAgICBDb25uZWN0aW9uOiBcImtlZXAtYWxpdmVcIixcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFxyXG4gICAgICBcIkFQSei3r+eUsemUmeivrzpcIixcclxuICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwi5pyN5Yqh5Zmo5YaF6YOo6ZSZ6K+vXCIgfSwgeyBzdGF0dXM6IDUwMCB9KTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImR5bmFtaWMiLCJQT1NUIiwicmVxdWVzdCIsImJvZHkiLCJqc29uIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJDT1pFX0FQSV9CQVNFX1VSTCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19DT1pFX0FQSV9CQVNFX1VSTCIsIkNPWkVfQk9UX0lEIiwiYm90X2lkIiwiTkVYVF9QVUJMSUNfQ09aRV9CT1RfSUQiLCJDT1pFX0FQSV9LRVkiLCJORVhUX1BVQkxJQ19DT1pFX0FQSV9LRVkiLCJDT1pFX1NIT1JUQ1VUX0NPTU1BTkRfSUQiLCJORVhUX1BVQkxJQ19DT1pFX1NIT1JUQ1VUX0NPTU1BTkRfSUQiLCJzaG9ydGN1dF9jb21tYW5kX2lkIiwid2FybiIsImlzU3RyZWFtIiwic3RyZWFtIiwibWVzc2FnZXMiLCJhZGRpdGlvbmFsX21lc3NhZ2VzIiwiQXJyYXkiLCJpc0FycmF5IiwicHVzaCIsImxlbmd0aCIsImNvbnRlbnQiLCJyb2xlIiwicmVxdWVzdEJvZHkiLCJ1c2VyX2lkIiwiYXV0b19zYXZlX2hpc3RvcnkiLCJhcGlFbmRwb2ludCIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsIm9rIiwiZXJyb3JUZXh0IiwidGV4dCIsImVycm9yIiwic3RhdHVzIiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJlbnRyaWVzIiwiZGF0YSIsInN1YnN0cmluZyIsInJlc3BvbnNlQ2xvbmUiLCJjbG9uZSIsInJlYWRlciIsImdldFJlYWRlciIsImRlY29kZXIiLCJUZXh0RGVjb2RlciIsImRlYnVnT3V0cHV0IiwiY2h1bmtDb3VudCIsImRvbmUiLCJ2YWx1ZSIsInJlYWQiLCJjaHVuayIsImRlY29kZSIsImVuY29kZXIiLCJUZXh0RW5jb2RlciIsInRlc3REYXRhIiwicmVhZGFibGUiLCJ3cml0YWJsZSIsIlRyYW5zZm9ybVN0cmVhbSIsIndyaXRlciIsImdldFdyaXRlciIsIm1lc3NhZ2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJ3cml0ZSIsImVuY29kZSIsInRyaW0iLCJjbG9zZSIsIlJlc3BvbnNlIiwiQ29ubmVjdGlvbiIsInRyYW5zZm9ybSIsImNvbnRyb2xsZXIiLCJlbnF1ZXVlIiwiZmx1c2giLCJwaXBlVG8iLCJjYXRjaCIsIkVycm9yIiwiU3RyaW5nIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/chat/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=C%3A%5CUsers%5Cplenty_seafood%5CDesktop%5CLLM_chatbox%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cplenty_seafood%5CDesktop%5CLLM_chatbox&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();